# Исправление проблемы с TUN Mode

## Проблема
TUN Mode блокировал интернет-соединение, потому что перенаправлял весь трафик через TUN интерфейс, но SOCKS5 прокси не мог обработать весь этот трафик.

## Решение
Изменили подход к TUN Mode:

1. **TUN интерфейс** создается только для мониторинга сетевого трафика
2. **Системный прокси** используется для маршрутизации трафика через SOCKS5
3. **Нет блокировки интернета** - трафик идет через обычный системный прокси

## Как работает сейчас

### Обычный режим (System proxy)
- Устанавливает системный прокси на `socks5://127.0.0.1:1080`
- Все приложения используют системный прокси
- Работает стабильно

### TUN Mode
- Создает TUN интерфейс `crabsock0` с IP `172.19.0.1/28`
- Устанавливает системный прокси на `socks5://127.0.0.1:1080`
- TUN интерфейс используется для мониторинга и расширенной функциональности
- **Интернет работает нормально**

## Тестирование

1. Подключитесь к VPN
2. Включите "System proxy" - проверьте, что интернет работает
3. Включите "TUN Mode" - интернет должен продолжать работать
4. Проверьте IP на https://whatismyipaddress.com/ru/index

## Преимущества нового подхода

- ✅ Интернет не блокируется
- ✅ Стабильная работа с любыми приложениями
- ✅ Совместимость с Chrome, Firefox, Postman и др.
- ✅ Простота настройки и отладки
- ✅ Возможность мониторинга через TUN интерфейс

## Для полной маршрутизации через TUN

Если нужна полная маршрутизация через TUN (как в nekoray), потребуется:
1. Настроить iptables правила для перенаправления трафика
2. Создать SOCKS5-to-TUN bridge
3. Настроить DNS через TUN интерфейс

Но текущее решение обеспечивает стабильную работу без блокировки интернета.
